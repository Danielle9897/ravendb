<div id="database-settings-view" class="content-margin flex-vertical absolute-fill">
    <div class="flex-horizontal flex-wrap margin-left margin-left-lg">
        <div>
            <button class="btn btn-primary" data-bind="click: save, enable: isSaveEnabled, css: { 'btn-spinner': spinners.save }">
                <i class="icon-save"></i><span>Save</span>
            </button>
        </div>
        <div class="btn-group">
            <button class="btn btn-default dropdown-toggle filter-entries" data-toggle="dropdown">
                <span data-bind="visible: groupToShow() === 'allEntries'"><span>All Entries</span></span>
                <span data-bind="visible: groupToShow() === 'databaseEntries'"><span>Database Entries</span></span>
                <span data-bind="visible: groupToShow() === 'customizedDatabaseEntries'"><span>Customized Database Entries</span></span>
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li title="Show all entries per database & server-wide"><a href="#" data-bind="click: _.partial(setGroupToShow, 'allEntries')"><span>All Entries</span></a></li>
                <li title="Show only entries per this database"><a href="#" data-bind="click: _.partial(setGroupToShow, 'databaseEntries')"><span>Database Entries</span></a></li>
                <li title="Show entries that are customized per this database"><a href="#" data-bind="click: _.partial(setGroupToShow, 'customizedDatabaseEntries')"><span>Customized Database Entries</span></a></li>
            </ul>
        </div>
        <div class="filter-entries">
            <input class="form-control" placeholder="Filter Keys" data-bind="textInput: filterKeys" />
        </div>
        <div>
            <button class="btn btn-default" data-bind="click: refresh, css: { 'btn-spinner': spinners.refresh }, disable: spinners.refresh() || spinners.save()" title="Reload settings">
                <i class="icon-refresh"></i><span>Refresh</span>
            </button>
        </div>
    </div>
    <div class="flex-horizontal flex-noshrink summary-buttons">
        <div class="flex-separator"></div>
        <div data-bind="visible: viewMode() === 'summaryMode'">
            <button class="btn btn-sm btn-default" data-bind="click: switchToEditMode" title="Edit the Database Settings">
                <i class="icon-edit"></i><span>Edit Entries</span>
            </button>
        </div>
        <div data-bind="visible: viewMode() === 'editMode', enable: !isSaveEnabled()">
            <button class="btn btn-sm btn-default" data-bind="click: exitEditMode" title="View all effective values in a condensed view">
                <i class="icon-table"></i><span>View Summary</span>
            </button>
        </div>
    </div>
    <div class="flex-horizontal flex-stretch-items absolute-fill content-margin entries-grid" data-bind="visible: viewMode() === 'editMode'">
        <div class="flex-vertical">
            <div class="categories-list-container flex-vertical flex-grow" style="position:relative;">
                <virtual-grid class="resizable virtual-grid" params="controller: categoriesGridController, emptyTemplate: 'db-settings-no-entries-loaded-template'"></virtual-grid>
            </div>
        </div>
        <div class="flex-grow flex-vertical slidein-style">
            <div data-bind="template: { name: 'db-settings-no-matching-entries-template' }, visible: !isAnyMatchingEntries()"></div>
            <div class="panel" data-bind="visible: isAnyMatchingEntries">
                <div class="row">
                    <div class="col-md-5 text-center"><h4><strong>Configuration Key</strong></h4></div>
                    <div class="col-md-7 text-center add-vertical-split"><h4><strong>Value</strong></h4></div>
                </div>
            </div>
            <!-- ko foreach: allEntries -->
            <div data-bind="template: { name: 'db-settings-basic-template' }, visible: showEntry"></div>
            <!-- Todo: diff template for arrays :  enums, strings, for now + make trap test !-->
            <!-- /ko -->
        </div>
    </div>
    <div class="flex-horizontal flex-stretch-items absolute-fill content-margin entries-grid" data-bind="visible: viewMode() === 'summaryMode'">
        <div class="flex-grow flex-vertical slidein-style">
            <div class="summary-list-container flex-vertical flex-grow" style="position:relative;">
                <virtual-grid class="resizable virtual-grid" params="controller: summaryGridController, emptyTemplate: 'db-settings-no-entries-loaded-template'"></virtual-grid>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="db-settings-no-entries-loaded-template">
    No entries loaded.
</script>

<script type="text/html" id="db-settings-no-matching-entries-template">
    <div class="panel">
        <div class="panel-body">No matching entries.</div>
    </div>
</script>

<script type="text/html" id="db-settings-basic-template">
    <form class="flex-form entry-basic-template" autocomplete="off">
        <div class="panel margin-bottom margin-bottom-xs entry-content">
            <div class="panel-body row">
                <div class="col-md-5 add-border">
                    <div class="form-group">
                        <div class="margin-top margin-top-sm">
                            <small><span data-bind="text: keyName" class="margin-right margin-right-sm"></span></small>
                            <span data-placement="bottom" data-toggle="tooltip" data-animation="true" data-html="true" data-bind="tooltipText: descriptionHtml">
                                <small class="text-info"><i class="icon-info"></i></small>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="col-md-7 add-vertical-split">
                    <div class="form-group no-margin">
                        <div class="margin-top margin-top-sm">
                            <small data-placement="left" data-toggle="tooltip" data-animation="true"
                                   data-bind="attr: { title: hasServerValue() ? 'This is a server-wide configuration' : 'This is the default configuration' }">
                                <i class="source-icon" data-bind="css: { 'icon-star-filled': hasServerValue(), 'source-icon-null': !serverOrDefaultValue() }"></i>
                                <i class="source-icon" data-bind="css: { 'icon-json': !hasServerValue(), 'source-icon-null': !serverOrDefaultValue() }"></i>
                            </small>
                            <small data-bind="text: serverOrDefaultValue() || 'null'" id="value"></small>
                            <small data-placement="right" data-toggle="tooltip" data-animation="true" data-html="true" data-bind="visible: isServerWideOnlyEntry"
                                   title="This is a server-wide entry.<br>It can be edited only from the <strong>settings.json</strong> file located in your RavenDB executable folder.">
                                <small class="margin-left margin-left-sm"><i class="icon-lock"></i></small>
                            </small>
                        </div>
                    </div>
                    <div data-bind="template: { name: isServerWideOnlyEntry() ? 'db-settings-serverWide-template' : 'db-settings-override-template' }"></div>
                </div>
            </div>
        </div>
    </form>
</script>

<script type="text/html" id="db-settings-serverWide-template">
    <div class="margin-top margin-bottom"></div>
</script>

<script type="text/html" id="db-settings-override-template">
    <div class="form-group no-margin margin-left margin-bottom margin-bottom-sm padding padding-xs no-padding-right">
        <div class="toggle">
            <input type="checkbox" data-bind="checked: override, attr: {'id': 'overrideToggle_' + keyName() }" />
            <label title="Customize the database value" data-bind="attr: { 'for': 'overrideToggle_' + keyName() }">
                <span>Override</span>
            </label>
        </div>
        <div data-bind="collapse: override" class="margin-top margin-top-lg override-options flex-grow">
            <div class="margin-top margin-top-sm"  data-bind="collapse: override, validationElement: customizedDatabaseValue">
                <div data-bind="template: { name: 'db-settings-' + getTemplateType() + '-template' }"></div>
            </div>
        </div>
    </div>
</script>

<!-- String -->
<script type="text/html" id="db-settings-String-template">
    <div class="flex-horizontal">
        <div class="flex-grow" data-bind="attr: { 'title': customizedDatabaseValue }">
            <input type="text" class="form-control" placeholder="Enter string. Null used if no value is entered." 
                   data-bind="textInput: customizedDatabaseValue" />
        </div>
        <div data-bind="template: { name: 'db-settings-default-button-template' }"></div>
    </div>
</script>

<!-- Enum & boolean -->
<script type="text/html" id="db-settings-Enum-template">
    <div class="flex-horizontal">
        <div class="dropdown btn-block">
            <button class="btn btn-default btn-block dropdown-toggle" data-toggle="dropdown">
                <span data-bind="text: customizedDatabaseValue"></span>
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu max-height" data-bind="foreach: availableValues">
                <li><a href="#" data-bind="text: $data, click: _.partial($parent.initCustomizedValue, $data)"></a></li>
            </ul>
        </div>
        <div data-bind="template: { name: 'db-settings-default-button-template' }"></div>
    </div>
</script>

<!-- Integer & nullable integer -->
<script type="text/html" id="db-settings-Integer-template">
    <div class="flex-horizontal" data-bind="validationOptions: { insertMessages: false }">
        <input type="number" min="0" class="form-control" data-bind="numericInput: customizedDatabaseValue,
               attr: { placeholder: isNullable() ? 'Enter number. Null used if no value is entered.' : 'Enter a new number'}" />
        <div data-bind="template: { name: 'db-settings-default-button-template' }"></div>
    </div>
    <span class="help-block" data-bind="validationMessage: customizedDatabaseValue"></span>
</script>

<!-- Double & nullable double -->
<script type="text/html" id="db-settings-Double-template">
    <div class="flex-horizontal" data-bind="validationOptions: { insertMessages: false }">
        <input type="number" min="0" class="form-control" data-bind="numericInput: customizedDatabaseValue,
               attr: { placeholder: isNullable() ? 'Enter number. Null used if no value is entered.' : 'Enter a new number'}" />
        <div data-bind="template: { name: 'db-settings-default-button-template' }"></div>
    </div>
    <span class="help-block" data-bind="validationMessage: customizedDatabaseValue"></span>
</script>

<!-- Path -->
<script type="text/html" id="db-settings-Path-template">
    <div class="flex-horizontal">
        <div class="dropdown btn-block" data-bind="validationOptions: { insertMessages: false }, validationElement: customizedDatabaseValue">
            <input type="text" class="form-control dropdown-toggle" data-toggle="dropdown" placeholder="Enter a new path"
                   data-bind="textInput: customizedDatabaseValue, attr: {'id': 'localFolderPath_' + keyName(), 'title': customizedDatabaseValue }" />
            <span class="caret dropdown-toggle" data-toggle="dropdown"></span>
            <ul class="dropdown-menu max-height" data-bind="foreach: folderPathOptions, autoComplete: '#localFolderPath_' + keyName()">
                <li data-bind="click: $parent.pathHasChanged">
                    <a href="#" data-bind="text: $data"></a>
                </li>
            </ul>
        </div>
        <div data-bind="template: { name: 'db-settings-default-button-template' }"></div>  
    </div>
    <span class="help-block" data-bind="validationMessage: customizedDatabaseValue"></span>
</script>

<!-- Time & nullable time -->
<script type="text/html" id="db-settings-Time-template">
    <div class="flex-horizontal" data-bind="validationOptions: { insertMessages: false }">
        <div class="input-group flex-grow">
            <input type="number" class="form-control" data-bind="numericInput: customizedDatabaseValue,
                   attr: { placeholder: isNullable() ? 'Enter time. Null used if no value is entered.' : 'Enter a new time', min: minValue }" />
            <div class="input-group-addon"><span data-bind="text: timeUnit"></span></div>
        </div>
        <div data-bind="template: { name: 'db-settings-default-button-template' }"></div>
    </div>
    <span class="help-block" data-bind="validationMessage: customizedDatabaseValue"></span>
</script>

<!-- Size & nullable size -->
<script type="text/html" id="db-settings-Size-template">
    <div class="flex-horizontal" data-bind="validationOptions: { insertMessages: false }">
        <div class="input-group flex-grow">
            <input type="number" min="0" class="form-control" data-bind="numericInput: customizedDatabaseValue,
                   attr: { placeholder: isNullable() ? 'Enter size. Null used if no value is entered.' : 'Enter a new size' }" />
            <div class="input-group-addon"><span data-bind="text: sizeUnit"></span></div>
        </div>
        <div data-bind="template: { name: 'db-settings-default-button-template' }"></div>
    </div>
    <span class="help-block" data-bind="validationMessage: customizedDatabaseValue"></span>
</script>


<!-- Uri - Scope is only ServerWideOnly -->
<!--<script type="text/html" id="db-settings-Uri-template">-->
<!--    <div class="flex-horizontal">-->
<!--        <div data-bind="validationOptions: { insertMessages: false }" class="flex-grow">-->
<!--            <input type="text" class="form-control" placeholder="Enter URI" data-bind="textInput: customizedDatabaseValue" />-->
<!--        </div>-->
<!--        <div data-bind="template: { name: 'db-settings-default-button-template' }"></div>-->
<!--    </div>-->
<!--    <span class="help-block" data-bind="validationMessage: customizedDatabaseValue"></span>-->
<!--</script>-->

<!-- StringArray - Scope is only ServerWideOnly -->
<!--<script type="text/html" id="db-settings-StringArray-template">-->
<!--</script>-->

<!-- EnumArray - Scope is only ServerWideOnly -->
<!--<script type="text/html" id="db-settings-EnumArray-template">-->
<!--</script>-->

<script type="text/html" id="db-settings-default-button-template">
    <div class="set-default margin-left margin-left-sm" title="Use the default value">
        <a href="#" data-bind="click: useDefaultValue"><small>Set default</small></a>
    </div>
</script>
